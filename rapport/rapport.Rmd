---
title: "Rapport d'analyse - Census Income"
author: "IF36 - Inspecteur Gadget"
date: "UTT - Semestre P23"

output:
  rmdformats::material:
    thumbnails: false
    gallery: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(readr)
library(usmap)
library(gridExtra)
```

```{r data, include=FALSE}
data <- read_csv("../data/census-income.csv")
```

# Introduction

Extrait du recensement de la population américaine effectué en 1994-1995, ce jeu de données contient les données d’un peu moins de 200 000 individus, réparties sur 40 variables. Ces données proviennent du Département du Commerce des États-Unis; nous sommes donc en présence de données qui s'attachent principalement à décrire des données démographiques et sur l'emploi.

À l'origine, ce jeu de données a été publié par Ronny Kohavi et Barry Becker (Data Mining and Visualization, Silicon Graphics) avec pour objectif de prédire si un individu gagne plus de 50 000 dollars par an, dans le cadre du machine learning.

Il est disponible sur le site de l'[UCI Machine Learning Repository](https://archive.ics.uci.edu/ml/datasets/Census-Income+%28KDD%29).



### Données

Ce dataset contient 199 523 observations et 42 variables. 

Pour chaque variable, les personnes recensées les ont remplies si elles étaient concernées. La liste des variables est la suivante :

- `age` : âge
- `class_of_worker` : type de l'emploi (gouvernement, auto-entrepreneur, privé)
- `detailed_industry_recode` : code de l'industrie où la personne travaille ([liste des codes](https://microdata.epi.org/variables/indocc/dind03/))
- `detailed_occupation_recode` : code du domaine de l'emploi de la personne ([liste des codes](https://www.icpsr.umich.edu/web/RCMD/studies/03303/datasets/0001/variables/PRDTOCC1?archive=RCMD))
- `education` : niveau d'éducation (lycée, université, ...)
- `wage_per_hour` : salaire horaire
- `enroll_in_edu_inst_last_wk` : inscription à une école la semaine dernière (lycée, université, ...)
- `marital_stat` : statut marital (marié, divorcé, veuf, ...)
- `major_industry_code` : nom de l'industrie principale où travaille la personne (agriculture, éducation, administration, ...)
- `major_occupation_code` : domaine de l'emploi principal de la personne (vente, pêche, forces armées, ...)
- `race` : ethnie (blanc, noir, asiatique, ...)
- `hispanic_origin` : pays d'origine de la personne (si elle est hispanique)
- `sex` : sexe (masculin, féminin)
- `member_of_a_labor_union` : appartenance à un syndicat (oui, non)
- `reason_for_unemployment` : raison du chômage (licenciement, départ, ...)
- `full_or_part_time_employment_stat` : statut d'emploi à temps plein ou partiel (temps plein, temps partiel (avec justification), ...)
- `capital_gains` : gains en capital
- `capital_losses` : pertes en capital
- `dividends_from_stocks` : dividendes des actions
- `tax_filer_stat` : statut de déclaration d'impôt (couple, célibataire, non déclarant, ...)
- `region_of_previous_residence` : région de la résidence précédente (nord, sud, est, ouest, à l'étranger)
- `state_of_previous_residence` : état de la résidence précédente (Floride, Californie, ...)
- `detailed_household_and_family_stat` : statut détaillé de la famille (exemple : enfant de + de 18 ans jamais marié)
- `detailed_household_summary_in_household` : statut détaillé de la famille dans le ménage (exemple : épouse du chef du ménage)
- `instance_weight` : poids de l'instance (pour la pondération, en fonction de la probabilité de l'observation)
- `migration_code-change_in_msa` : changement résidentiel, dans une zone métropolitaine différente
- `migration_code-change_in_reg` : changement résidentiel, dans une région différente mais dans le même pays
- `migration_code-move_within_reg` : changement résidentiel, dans la même région mais dans un autre état
- `live_in_this_house_1_year_ago` : habite dans la même maison depuis au moins un an
- `migration_prev_res_in_sunbelt` : changement résidentiel où la résidence précédente était dans le sud des États-Unis
- `num_persons_worked_for_employer` : nombre de personnes travaillant pour l'employeur de la personne
- `family_members_under_18` : Quand concerne des personnes ayant moins de 18ans, précise les membres de la famille présent (père, mère ou les deux)
- `country_of_birth_father` : pays de naissance du père de la personne
- `country_of_birth_mother` : pays de naissance de la mère de la personne
- `country_of_birth_self` : pays de naissance de la personne
- `citizenship` : citoyenneté (née aux États-Unis, née à l'étranger, ...)
- `own_business_or_self_employed` : propriétaire d'une entreprise ou auto-entrepreneur
- `fill_inc_questionnaire_for_veteran_admin` : a rempli un questionnaire de revenus pour l'administration des anciens combattants (oui, non)
- `veterans_benefits` : possède des avantages pour anciens combattants (oui, non)
- `weeks_worked_in_year` : nombre de semaines travaillées dans l'année
- `year` : année du recensement
- `income_level` : niveau de revenu (inférieur à 50k, supérieur à 50k)

Plus d'informations sur la signification des variables sont disponibles sur le site du [Census Bureau](https://www.census.gov/).



### Plan d'analyse

La présence de données ethniques est une des spécificités de ce jeu de données. Celles-ci ne sont en effet pas présentes dans les données issues des instituts français, empêchant de facto l'étude des inégalités liées à la race* sur une grande échelle.


Nous avons donc décidé de profiter de la présence de l’attribut ethnique ("race") pour étudier l’impact de l’appartenance à un groupe racisé* sur la situation économique de la personne, et plus particulièrement sur son revenu.
Nous essaierons d’affiner notre analyse en croisant nos résultats avec d’autres données: 
- Le sexe ; Est-ce un facteur d’aggravation des inégalités raciales ?
- La situation géographique ; Le lieu de résidence (la Sunbelt par exemple) influe-t-il sur le niveau de vie et la qualité des emplois ?
- Le statut marital et la situation familiale ; Le mariage profite-t-il économiquement aux individus ? On pourra aussi pondérer les revenus en fonction du nombre de personnes composant les foyers.
- temporel (générations); Les enfants américains nés de parents étrangers sont-ils mieux intégrés au marché de l’emploi que leurs parents avant eux ?


Enfin, nous nous attacherons à essayer de comprendre les inégalités économiques. Pour cela nous nous pencherons sur les données structurelles : 
- Le niveau scolaire; La poursuite d’études permet-elle l’accès aux plus hauts revenus ? Élimine-t-elle le travail précaire ?
- La qualité de l’emploi (nombre de semaines travaillées, salaire horaire, cause du chômage, domaine d’activité, syndicat,); L’ethnie a-t-elle un impact sur les postes occupés et la rémunération des individus ? 
- Le capital



Il est tout de même important de noter que les données datent des années 90 et que les visualisations que nous allons réaliser ne seront pas forcément représentatives de la situation actuelle. Il sera donc nécessaire de replacer ces visualisations dans le contexte de l'époque afin de les interpréter correctement.


> *NB : “race” est un mot de vocabulaire employé dans le champ de la recherche en sociologie, en France comme aux États-Unis. 



# Exploration

Pour commencer, comme ce jeu de données est d'abord un recencement de la population américaine, il nous semble important d'en comprendre les principales caractéristiques (âge, sexe, origine) afin de dresser un portrait de l'américain moyen en 1994.


### Répartition par âge


Commençons donc avec la répartition par âge de notre échantillon.


```{r income, echo=FALSE}
ggplot(data, aes(x = age)) +
    geom_histogram(binwidth = 5) +
    labs(title = "Age distribution", x = "Age", y = "Count")
```


On remarque ainsi que la majeure partie de l'échantillon a moins de 45 ans. Il existe néanmoins de fortes disparités ; l'engagement des États-Unis dans la guerre du Vietnam, notamment à partir de 1965 explique en partie ces écarts démographiques. Les classes d'âge qui se sont majoritairement enrolés au Vietnam ont entre 40 et 50  au moment de l'enquête, et on peut constater leur sous-représenatation dans la population générale. En mobilisant plus de 2 millions de soldats, dont la moyenne d'âge était de 19 ans, la guerre a en effet fait un peu moins de 60 000 morts du côté américain.

Un déficit des naissances est aussi observé pour les classes d'âges allant de 12 à 30 ans, avec un pic vers 20 ans ; ce sont des naissances "manquantes", qui n'ont pas eu lieu à cause de l'absence des hommes enrolés dans la guerre.

Ce déficit s'observe aussi sur la pyramide des âges.
De plus, le jeu de données est à l'origine utilisé pour faire du machine learning afin de prédire la tranche de salaire en fonction d'autres paramètres. Ainsi, les individus les plus pertinents à interroger se situent entre 20 et 60ans, en sachant que le taux d'emploi décroit mécaniquement avec l'avancée en âge. 

### Pyramide des âges

```{r pyramide, echo=FALSE}
ages <- data %>%
    mutate(age_range = cut(age,
        breaks = seq(min(data$age), max(data$age), 5), include.lowest = TRUE
    ))

ggplot(data = ages, aes(x = as.factor(age_range), fill = sex)) +
    geom_bar(data = subset(ages, sex == "Female")) +
    geom_bar(
        data = subset(ages, sex == "Male"),
        aes(y = after_stat(count) * (-1))
    ) +
    coord_flip() +
    labs(title = "Pyramide des âges", x = "Âge", y = "Nombre de personnes")
```

On peut aussi constater que les femmes vivent plus longtemps que les hommes, puisqu'elles représentent par exemple 3/4 de la classe d'âge 85-90 ans. Une hygiène de vie plus favorable, avec moins de tabac ou d'alcool, peut en partie expliquer cet écart.

### Pays de naissance

On s'intéresse désormais aux pays de naissance des personnes interrogées dans notre échantillon.

```{r birthcountrybar, echo=FALSE}
#US vs AUTRE
counts <- table(data$country_of_birth_self)
nb_etats_unis <- counts["United-States"]
nb_autres_pays <- sum(counts) - nb_etats_unis

graph_data <- data.frame(
  Pays = c("États-Unis", "Autres"),
  Fréquence = c(counts["United-States"], sum(counts) - counts["United-States"])
)

ggplot(data = graph_data, aes(x = Fréquence, y = Pays, fill = Pays)) +
  geom_bar(stat = "identity", width = 0.5) +
  xlab("Fréquence") +
  ylab("Pays") +
  ggtitle("Comparaison du nombre de personnes ayant les EU comme pays de naissance et le reste")
```

On constate que l'écrasante majorité de la population interrogée est née aux États-Unis. 

```
Le graph fonctionne pas???? déduire un pourcentage et comparer éventuellement à d'autrs pays ou à maintenant
```

Il convient aussi de souligner qu'un pays de naissance n'est pas toujours révélateur d'une nationalité. Un enfant américain peut très bien naître sur le sol français par exemple. Néanmoins cet indicateur peut être utile pour modéliser les mobilités de population et l'attraction des États-Unis sur la scène internationale. Il est un indicateur complémentaire de la nationalité, qui elle aussi peut-être variable (elle peut s'acquérir par exemple, après un certains nombres d'années de résidence).


```{r birthcountry, fig.height=8, echo=FALSE}
ggplot(data, aes(y = country_of_birth_self)) +
    geom_bar() +
    labs(
        title = "Country of birth",
        x = "Count", y = "Country"
    )
```

Quelques pays comme le Mexique semblent néanmoins se distinguer du fait de sa proximité avec les États-Unis (frontière commune). Cette information peut être mise en perspective avec les débats des années 2010 sur la construction d'un mur à la frontière entre les États-Unis et le Mexique pour endiguer le flux migratoire venant du Mexique mais aussi de l'Amérique latine.  
Pour mieux appréhender la pluralité des pays d'origine de ces immigrés, voici donc un autre graphique, qui exclut cette fois-ci les États-Unis.








### Immigration
### Pays de naissance - Hors États-Unis

```{r birthcountrynous, fig.height=8, echo=FALSE}
no_us <- data %>%
    filter(country_of_birth_self != "United-States")

ggplot(no_us, aes(y = country_of_birth_self)) +
    geom_bar() +
    labs(
        title = "Country of birth",
        x = "Count", y = "Country"
    )
```

On a cette fois-ci une vision plus claire des pays de naissance. On constate une assez grande diversité géographique, puisque presques tous les continents sont représentés ; l'Amérique du Sud ( Mexique, Salvador, etc), l'Asie (Vietnam, Laos,Philippines,Inde, Japon,etc) mais aussi l'Europe (Italie,Allemagne).

Au niveau des proportions, le Mexique s'impose assez largement comme 1er pays de naissance (hors États-Unis) de la population. Attirée par un pays voisin au niveau de vie supérieur, on peut aisémment supposer qu'une partie de la population mexicaine a fait le choix de s'intaller aux États-Unis. On retouve de la même manière plusieurs pays latino-américains comme Puerto-Rico ou Cuba en haut du classement.

Le rayonnement culturel des États-Unis, accentué par les politiques mises en place durant la Guerre Froide, à fait apparaître le pays comme un nouvel Eldorado, et a attiré les populations du monde entier en quête d'un avenir meilleur.

La forte présence de population née en Allemagne pourrait elle, être expliquée par une émigration durant et post-2nde guerre mondiale, notamment chez les populations de confession juive. 



Après avoir étudié la répartition internationale des lieux de naissance, intéressons-nous maintenant aux lieux de résidence intra-étatique.


### Carte des États-Unis représentant les Etats précédents de résidence

```{r maptwo, echo=FALSE}
previous_residence_data <- data %>%
    filter(state_of_previous_residence != "Not in universe" &
        state_of_previous_residence != "?") %>%
    group_by(state_of_previous_residence) %>%
    summarise(count = n()) %>%
    arrange(desc(count)) %>%
    rename(state = state_of_previous_residence)

plot_usmap(
    data = previous_residence_data,
    values = "count"
) +
    scale_fill_continuous(
        low = "white", high = "#DC143C",
    ) +
    theme(legend.position = "right") +
    labs(
        title = "State of Previous Residence",
        fill = "Number of people"
    )
```


La Californie, l'Utah, la Floride et la Caroline du Nord comptent pour les Etats les plus représentés dans la population sondée.

La Californie ( 3o millions d'habitant en 1994) et la Floride (31 millions) sont en effet les Etats les plus peuplés des États-Unis, et il n'est pas étonnant de les retrouver sur cette carte. De plus, le gouverneur de Californie Pete Wilson (Républicain) en poste en 1994 s'est lancé dans une croisade contre les immigrés de son Etat. La Proposition 187 de Californie était une proposition de loi controversée qui a été soumise au vote des électeurs en Californie lors des élections de novembre 1994. Son titre officiel était l'« Initiative de la loi sur l'immigration illégale ». Elle visait à restreindre l'accès des immigrants sans papiers aux services publics, tels que l'éducation et les soins de santé. Un débat a été engagé sur la constitutionnalité de cette loi. Cependant, de nombreux personnes issues de l'immigration ont préféré quitter l'Etat.  La présence de l'Utah est plus surprenante, alors qu'en 1994 la population de cet Etat n'excédait par les 2 millions de personnes. On peut faire le même constat pour la Caroline du nord, et ses 7 millions d'habitants.

On peut faire plusieurs conjonctures pour expliquer cette carte. Tout d'abord, il faut rappeler que malgré sa volonté d'être représentative de la population américaine, ce recensement ne se base "que" sur 200 000 personnes, et qu'il peut donc y avoir des biais, surtout géographiques. On n'a en effet pas les lieux où les enquêtes ont été majoritairement menées, et il est possible qu'il y ait eu un plus fort taux de réponses dans certains Etats comme l'Utah qu'ailleurs.

Deuxième piste, les données portaient sur l'Etat de "précédente résidence" ; on peut donc faire l'hypothèse que les habitants de l'Utah et de la Caroline du Nord sont plus souvent partis de ces Etats pour s'installer dans d'autres. La forte population dans certains Etats ne seraient pas donc dû à un solde naturel possitif de naissance inter-étatique, mais bien à des mobilités de population à l'échelle nationale.

Ces suppositions sont évidemments insuffisantes pour expliquer ce décalage, mais elles nous permettent de nous apporter quelques pistes de réflexions, et surtout de garder à l'esprit de toujours s'interroger sur la provenance des données.


### ???????? La présentation est finie depuis un moment
Maintenant que le jeu de données est présenté, nous allons étudier l'impact du  genre et de l'ethnie sur la vie des individus, et leurs opportunités salariales et éducatives. 

Les données ethniques sont en effet autorisées aux États-Unis, ce qui n'est pas le cas en France par exemple, et il nous a semblé important et pertinent d'utiliser ses données pour appuyer nos analyses.




Voici donc un graphique présentant le niveau de revenu, en fonction de l'ethnie de la personne.


### Niveau de revenu en fonction du sexe

```{r incomesex, echo=FALSE}
ggplot(data, aes(x = income_level, fill = sex)) +
    geom_bar(position = "fill") +
    labs(x = "Income Level", y = "Count", fill = "Sex")
```

Les catégories de revenu sont divisées en deux, soit moins de 50 000 dollars par an, soit plus que 50 000 dollars par an, puisque le jeu de données ne comporte pas de données plus précise.
Le revenu moyen d'un foyer américain en 1990 était en effet de 50 000 dollars annuel, ce qui rend le choix de cette valeur pertinent pour avoir un rapide aperçu de la situation financière des personnes interrogés dans le cadre de cette étude. On suppose donc que c'est pour cette raison qu'elle a été incluse dans le jeu de données.
 
Si on analyse néanmoins les résultats, on constate qu'une majeure partie des sondés gagne moins de 50 000 dollars par an, et q'une minorité seulement arrive à avoir un travail plus rémunérateur. Lorsqu'on parlait plus tôt de "foyer", on peut néanmoins préciser que ceux-ci sont en général constitués de plus d'une personne, et quand plus de 70% des femmes travaillent en 1990, le revenu du foyer est en général constitué de 2 salaires. Cette distinction peut permettre de mieux comprendre pourquoi une large partie de la population interrogées demeure donc sous le seuil des 50 000 dollars de revenus annuel.
 
Même si hommes et femmes travaillent, on constate tout de même que la répartition des salaires entre les deux genres n'est pas la même. Parmi les populations les plus favorisés ( plus de 50 000 dollars par an), seul un quart sont des femmes. Au contraire, elles représentent plus de la moitié de ceux gagnant moins de 50 000 dollars par mois. 

##Pourquoi faire l'explication plus tard ? Autant la faire ici. Au besoin : copie - colle. 
Cet écart de revenu entre les hommes et les femmes peut s'expliquer de plusieurs manières. Premièrement, le salaire horaire d'une femme est souvent inférieur à celui d'un homme - à poste équivalent, âge équivalent, expérience et formation équivalentes. En effet il est intériosé que les femmes vont avoir des enfants et seront donc moins impliquées dans leur travail. De plus, lorsque ces mêmes enfants seront malades, il y a de fortes chances que cela soit la conjointe qui prenne des congés pour s'occuper d'eux. Deuxièmement, l'éducation est très souvent genrée. De ce fait, les femmes sont souvent orientée vers des filières qui leur "corrrespondent" (stéréotype de genres) comme par exemple les métiers du "care" - car bien évidement, les femmes sont naturellemnt douées pour s'occuper des autres. Or ces filières genrées avec des métiers identifiées comme féminins sont les filières peu rémunératrices. Troisièmement, les femmes ont tendance à plus être en temps partiel que les hommes. En effet, ces dernières doivent généralement s'occuper des enfants et du travail domestique en plus de leur travail rémunéré. De plus, en reprenant nos précedentes explications (salaire horaire inférieur), il est plus rationnel que cela soit la femme qui renonce à une partie du travail rémunéré car le coût d'opportunité sera moindre. (expliqué par Gary Becker, 1981, A Treaty on the Family).
 
Il faudra donc essayer de trouver les causes de cette inégalité de revenus ; on s'intéressera dans la suite à l'impact de l'éducation, mais aussi du choix du secteur d'activité, qui pourraient apporter des pistes d'explications.
 
Pour le moment, intéressons-nous à l'impact de l'ethnie sur le niveau de revenu. 
 
### Niveau de revenu en fonction de l'ethnie

```{r level, echo=FALSE}
ggplot(data, aes(x = income_level, fill = race)) +
    geom_bar(position = "fill") +
    labs(
        title = "Income level by race",
        x = "Income Level", y = "Percentage", fill = "Race"
    )
```

```Base 100 explication ```

Avec ce graphisme, on constate qu'il existe bien des inégalités raciales au niveau du salaire. Alors que les populations caucasiennes sont, en proportion, plus représentés dans les salaires supérieurs à 50 000 dollars mensuels, c'est l'inverse pour les populations noires. Leur proportion réduit en effet presque de moitié (....)
De l'autre côté, les populations en provenance d'Asie sont un peu mieux représentées dans les salaires à +50000dollars que dans les salaires à -50000dollars.  (cas des populations asiatiques).

```{r wage_per_hour, echo=FALSE}
wage <- data %>%
  filter(wage_per_hour != 0 & race != "Other" & age < 75)

average_income_by_age_race <-
  aggregate(wage_per_hour ~ age + race, data = wage, FUN = mean)

ggplot(data = average_income_by_age_race, aes(
  x = age, y = wage_per_hour,
  color = race
)) +
  geom_smooth(se = FALSE) +
  geom_vline(xintercept = 40, linetype = "dashed", color = "red") +
  geom_vline(xintercept = 55, linetype = "dashed", color = "red") +
  labs(
    title = "Salaire horaire moyen en fonction de l'âge et de l'ethnie",
    x = "Age", y = "Salaire horaire",
    color = "Ethnie"
  )
```

Plusieurs phénomènes apparaissent sur ce graphique. Nous allons tout d'abord nous intéresser à l'allure globale des courbes. Nous pouvons en effet noter que les courbes sont concaves. Il semblerait ainsi que le salaire horaire croit jusqu'à un certain âge puis décroit. Cette décroissance peut être analysée comme une anomalie car, dans de nombreuses études, il est montré que le salaire horaire croit jusqu'à l'âge de la retraite, ce qui n'est pas le cas ici. Il semblerait cependant que nous soyons ici face à un effet de génération. En effet si l'on se renseigne sur l'évolution du salaire moyen aux États-Unis, nous apprenons que le salaire horaire moyen a progressivement évolué pendant la Seconde Guerre Mondiale avant de connaître une importante hausse dans les années 60. Les personnes entrées dans l'emploi dans ces années là correspondent, de manière générale, aux personnes nées entre 1940 et 1955. Ces personnes sont donc agées, lors de l'enquête, de 40 à 55 ans. Ces âges correspondent aux points hauts de trois de courbes. Ces personnes ont bénéficié d'un salaire horaire de départ plus important que leurs prédécesseurs qui n'a cessé de progresser avec l'expérience. 

Ce phénomène d'augmentation du salaire avec l'âge est visible sur la partie montante de la courbe concave. En effet, le salaire augmente souvent avec l'expérience. 

Nous allons maintenant nous interesser aux différences entre les ethnies. Tout d'abord nous constatons que le salaire horaire moyen maximum des personnes Afro-Américaines est plus faible que celui des autres ethnies. Cela peut s'expliquer par un racisme encore bien ancré dans la société américaine qui se traduit par une discrimination à l'emploi. De plus, les personnes Afro-américaines sont plus représentées dans des secteurs peu rémunérateurs. 
(à mettre en relation avec les industries codes). + (mettre en relation avec le niveau d'éducation, aussi pour asiats). 

 







